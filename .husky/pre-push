#!/bin/sh

echo "ğŸ” Checking if /frontend has changed..."

# Read stdin for remote and ref info
while read local_ref local_sha remote_ref remote_sha
do
  # Get diff of files being pushed
  changes=$(git diff --name-only "$remote_sha" "$local_sha" -- frontend/)

  if [ -n "$changes" ]; then
    echo "ğŸ“¦ Changes detected in /frontend:"
    echo "$changes"
    echo "âš™ï¸  Running Bun build..."

    cd frontend || {
      echo "âŒ Could not find /frontend folder."
      exit 1
    }

    bun run build

    if [ $? -ne 0 ]; then
      echo "âŒ Build failed. Push aborted."
      exit 1
    fi

    echo "âœ… Build succeeded."
  else
    echo "âœ… No changes in /frontend. Skipping build."
  fi
done

exit 0
